---
import { text, defaultLang } from "../content/text.js";

const lang = defaultLang;
const t = text[lang];
---

<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8" />
    <title>{t.brand}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/styles/global.css" />
  </head>
  <body>
    <header>
      <nav class="nav">
  <div class="nav-brand" data-i18n="brand">
    {t.brand}
  </div>

  <button class="hamburger" id="hamburger-btn">☰</button>

  <div class="nav-right" id="nav-menu">
    <a href="/" data-i18n="nav.home">{t.nav.home}</a>
    <a href="/about" data-i18n="nav.about">{t.nav.about}</a>
    <a href="/services" data-i18n="nav.services">{t.nav.services}</a>
    <a href="/contact" data-i18n="nav.contact">{t.nav.contact}</a>

    <span class="nav-lang">
      <a href="#" data-lang="zh">中文</a>
      <span>|</span>
      <a href="#" data-lang="ja">日本語</a>
    </span>
  </div>
</nav>
    </header>

    <main>
      <slot />
    </main>

    <footer data-i18n="brand">
      {t.brand}
    </footer>
  </body>

   <script define:vars={{ text }}>
    let currentLang = localStorage.getItem("lang") || "zh";
    
    function applyLanguage(lang) {
      currentLang = lang;
      localStorage.setItem("lang", lang);
      document.documentElement.lang = lang;
      
      // Translate simple data-i18n elements
      document.querySelectorAll("[data-i18n]").forEach(el => {
        const keys = el.dataset.i18n.split(".");
        let value = text[lang];
        for (const key of keys) {
          value = value[key];
        }
        if (typeof value === "string") {
          el.textContent = value;
        }
      });
      
      // Re-render feature list (home page)
      const featureList = document.querySelector("[data-feature-list]");
      if (featureList && text[lang].home.features) {
        featureList.innerHTML = text[lang].home.features.map(f => `
          <div class="card feature">
            <h3>${f.title}</h3>
            <p>${f.desc}</p>
          </div>
        `).join("");
      }
      
      // Re-render service list (services page)
      const serviceList = document.querySelector("[data-service-list]");
      if (serviceList && text[lang].services.items) {
        serviceList.innerHTML = text[lang].services.items.map(item => `
          <div class="card service-item">
            <h2>${item.title}</h2>
            <p>${item.desc}</p>
          </div>
        `).join("");
      }
    }
    
    document.querySelectorAll("[data-lang]").forEach(link => {
      link.addEventListener("click", (e) => {
        e.preventDefault();
        applyLanguage(link.dataset.lang);
      });
    });
    
    applyLanguage(currentLang);

    // Hamburger menu toggle
    const hamburgerBtn = document.getElementById('hamburger-btn');
    const navMenu = document.getElementById('nav-menu');
    hamburgerBtn.addEventListener('click', () => {
      navMenu.classList.toggle('open');
    });

    // Close menu when clicking outside
    document.addEventListener('click', (e) => {
      if (!navMenu.contains(e.target) && e.target !== hamburgerBtn) {
        navMenu.classList.remove('open');
      }
    });
  </script>
</html>